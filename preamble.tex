% Include other pdf
\usepackage{pdfpages}
% \usepackage{navigator} % To mofidy the outline https://osl.ugr.es/CTAN/macros/generic/navigator/navigator-doc.pdf



% Include the indices of tables and figures
% https://tex.stackexchange.com/a/48512/178206
\usepackage{tocbibind}

% To add figure after the environment not later at the end of the section
% From https://stackoverflow.com/a/33801326/2886003
\usepackage{float}
\usepackage{colortbl}
\let\origfigure\figure
\let\endorigfigure\endfigure
\renewenvironment{figure}[1][2] {
    \expandafter\origfigure\expandafter[!htp]
} {
    \endorigfigure
}

% Page number the same even for first page of chapter
\usepackage[automark,headsepline]{scrlayer-scrpage}% sets page style scrheadings automatically
\clearpairofpagestyles
\ihead{\leftmark}
\ohead*{\pagemark}
\setkomafont{pagenumber}{}% default is \normalfont\normalcolor

% Reduce space between chapter title and top of page
% https://tex.stackexchange.com/a/63393/178206
% Remove chapter number
% https://tex.stackexchange.com/a/519236/178206
\usepackage{titlesec}
\titleformat{\chapter}[display]{\normalfont\huge\bfseries}{}{20pt}{\Huge}
% \titleformat{\chapter}[display]{\normalfont\huge\bfseries}{\null\hfill \chaptertitlename\ \thechapter}{20pt}{\Huge}
\titlespacing*{\chapter}{0pt}{-50pt}{40pt}

% To handle captions and make them wide even if tables are not
% https://stackoverflow.com/a/46101575/2886003
\usepackage{caption}
% Set in bold the numbering of tables and chapters
\captionsetup{labelfont=bf,width=\textwidth}
% Set table caption below tables, from example code on: https://tex.stackexchange.com/a/508243/178206
% But it doesn't work per design on kable https://github.com/yihui/knitr/issues/1189
% \captionsetup{labelfont=bf,width=\textwidth,positon=below}

% To be able to set table on the center and not overlap much on the right margin
\usepackage{adjustbox}

% Allow figures and tables in a page from https://bookdown.org/yihui/rmarkdown-cookbook/figure-placement.html#adjust-latex-placement-rules
\renewcommand{\topfraction}{.85}
\renewcommand{\bottomfraction}{.7}
\renewcommand{\textfraction}{.15}
\renewcommand{\floatpagefraction}{.66}
\setcounter{topnumber}{3}
\setcounter{bottomnumber}{3}
\setcounter{totalnumber}{4}

% Creating marker on the page margins
% https://tex.stackexchange.com/questions/113323/how-can-one-put-a-marker-to-every-page-in-a-chapter
% Check this answer https://tex.stackexchange.com/questions/262950/modify-chapter-thumb-for-appendix
\usepackage[scale=1,angle=0,opacity=1,contents={}]{background}
\usetikzlibrary{calc}
\usepackage{ifthen}
\usepackage{lipsum}
% auxiliary counter
\newcounter{chapshift}

% the list of colors to be used (add more if needed)
\newcommand\BoxColor{%
  \ifcase\thechapshift blue!30\or red!30\or olive!30\or magenta!30\or teal!30\or lime!30\or orange!30\or violet!30\or brown!30\else yellow!30\fi}

% the main command; the mandatory argument sets the color of the vertical box
\newcommand\ChapFrame{%
  \def\TitleText{\leftmark}%
  \AddEverypageHook{%
    \ifthenelse{\isodd{\value{page}}}
      {\backgroundsetup{
        contents={%
          \begin{tikzpicture}[overlay,remember picture]
          \node[fill=\BoxColor,inner sep=0pt,rectangle,text width=1cm,
            text height=3cm,align=center,anchor=north east]
          at ($ (current page.north east) + (-0cm,- 3*\thechapshift cm) $)
          % {\rotatebox{90}{\parbox{4cm}{%
          %   \centering\textcolor{black}{\scshape\thechapshift}}}};
          {};
          \end{tikzpicture}
        }%
      }
    }
    {\backgroundsetup{
      contents={%
        \begin{tikzpicture}[overlay,remember picture]
        \node[fill=\BoxColor,inner sep=0pt,rectangle,text width=1cm,
          text height=3cm,align=center,anchor=north west]
        at ($ (current page.north west) + (-0cm,-3*\thechapshift cm) $)
        % {\rotatebox{90}{\parbox{4cm}{%
        %   \centering\textcolor{black}{\scshape\thechapshift}}}};
        {};
        \end{tikzpicture}
      }
    }
  }
\BgMaterial}%
\stepcounter{chapshift}
}

% Make empty pages without headers https://tex.stackexchange.com/a/1684/178206
\usepackage{emptypage}
